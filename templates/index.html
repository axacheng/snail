<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
	    <title> Main - Snail </title>
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	    <link href="/static/css/bootstrap.min.css" rel="stylesheet" media="screen">
	</head>
	<body>
		<script src="http://code.jquery.com/jquery.js"></script>
		<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
		<script src="/static/js/bootstrap.min.js"></script>
		<script src="/static/js/bootstrap-formhelpers-phone.format.js"></script>
		<script src="/static/js/bootstrap-formhelpers-phone.js"></script>

		<div class="container-fluid">
			<div class="row-fluid">
			  <div class="span4">
			  	<div class="row-fluid">
			  		{% for doctor in available_doctor %}
          		<div class="span4">
          			Dr.: {{ doctor.dr_name }} <br>
          			Dr. specialty: {{ doctor.dr_major }} <br>
          			Dr. Description: {{ doctor.dr_description }} <br>
          		</div>
          	{% endfor %}
        	</div>
			  </div> <!-- span4 -->
			
			  <div class="span8">
					<form id="make_appointment" action="/appointment/make/" method="POST" class="form-horizontal">

			  		<div class="control-group">
			    		<label class="control-label">Dcotor</label>
			    		<div class="controls">
			      		<input name="form_data" class="input-xlarge" type="text" id="doctor_name" value="Lin">
			    		</div>
			  		</div>

			  		<div class="control-group">
			    		<label class="control-label">Date</label>
			    		<div class="controls">
			      		<input name="form_data" class="input-xlarge" type="text" id="datepicker" />
			    		</div>
			  		</div>

			  		<div class="control-group" id="pick_time">
			  		</div> <!-- #pick_time -->

			  		<br><br><br>
			  		<div class="control-group" id="appointment_summary">
				  		<div class="control-group">
				    		<label class="control-label">Name</label>
				    		<div class="controls">
				      		<input name="form_data" class="input-xlarge" type="text" id="patient_name" placeholder="Name">
				    		</div>
				  		</div>

				  		<div class="control-group">
				    		<label class="control-label">Phone</label>
				    		<div class="controls">
				      		<input name="form_data" type="text" class="input-xlarge bfh-phone" data-country="US">
				    		</div>
				  		</div>

				  		<div class="control-group">
				    		<label class="control-label">Email</label>
				    		<div class="controls">
				      		<input name="form_data" type="email" class="input-xlarge" data-country="US">
				    		</div>
				  		</div>

				  		<div class="control-group">
				    		<label class="control-label">SID</label>
				    		<div class="controls">
				      		<input name="form_data" class="input-xlarge" type="number" id="sid" placeholder="SID">
				    		</div>
				  		</div>

				  		<div class="control-group">
				    		<div class="controls">
				      		<input type="submit" class="btn btn-primary" value="Make An Appointment" />
				    		</div>
				  		</div>
					  </div> <!-- appointment_summary -->
			  	</form> <!-- #make_appointment -->
			  </div> <!-- span8 -->
			</div> <!-- row-fluid -->
		</div> <!-- container-fluid -->

		<script type="text/javascript">
			//
			var doctor = $('#doctor_name').val()
			$( "#datepicker" ).datepicker({
				buttonImage: "http://jqueryui.com/resources/demos/datepicker/images/calendar.gif",
				buttonImageOnly: true,
				dateFormat: "yymmdd",
				minDate: 0,
				maxDate: "+3M +10D",
				showOn: "button"}
			); // .datepicker end

			//
			$("#datepicker" ).change(function() {
				// clean up
				$('#pick_time').empty()
				var date = $('#datepicker').val()
  			$.ajax({
  				url: "/appointment/query/timeline/"+doctor + "/" + date,
  				type: "GET",
  				success: function(response_json){
  					response_json = $.parseJSON(response_json)
  					$.each(response_json, function(index, value){
  						//alert(value)
  						$('#pick_time').append("<div class='span4 pick_time' style='background-color:#EEEEEE;height:90px;width:150px'>" + value + "</div>")
  					}); //.each end				
  				} // success end
  			}) //.ajax end
  		}); // .change end


			//$(document).on(events, selector, data, handler);
			$('#make_appointment').on('click', '.pick_time', function(){
				alert($(this).text())
			}); // #make_appointment.on end


			//
  		$("#make_appointment").submit(function(event){
			  // Stop form from submitting normally
			  event.preventDefault();

			  var $form = $(this),
			  url = $form.attr( "action" );
			  var form_data = $("input[name='form_data']")
			  var posting = $.post( url, form_data.serialize())

			  posting.done(function(data){
			  	console.log('from server return', data)
			  });
			}); // #make_appointment.submit end

		</script>
	</body>
	<footer>
	</footer>
</html>


